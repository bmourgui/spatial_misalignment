---
title: "Dealing with grain mismatch between response and explanatory variables in species distribution models."
classoption: a4paper
#geometry: "left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm"
output:
  bookdown::pdf_document2:
  #pdf_document:
    keep_tex: true
    number_sections: true
    toc: false
  word_document: default
  documentclass: article
fontsize: 12pt
header-includes:
- \usepackage{float}
- \floatplacement{figure}{H}
#- \usepackage{flafter}
#- \usepackage{nopageno}
- \usepackage{lscape}
- \usepackage{amsmath}
- \usepackage{caption}
- \usepackage{graphicx}
- \graphicspath{ {../results/img/} }
- \usepackage[left]{lineno}
- \linenumbers
- \usepackage{setspace}\setstretch{2}
bibliography: paper_misalign.bib
csl: ecology.csl
---
```{r setup, include=FALSE}
library(bookdown)
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE, 
	fig.pos = "H",
	fig.align = 'center',
	tab.pos = 'H')

library(magrittr)
library(INLA)
```
# Abstract {-}
Species distribution models (SDMs) are extensively used in ecology to estimate species-environment relationships (SER) and predict species distributions across space and time. For this purpose, it is key to choose a relevant spatial resolution at the onset of the modelling process. However, environmental variables are often derived from global climate models at a resolution that does not necessarily correspond to the ecological grain at which the environment influences organisms. Such spatial misalignment between ecological and environmental data is a common challenge in SDMs because it can bias estimates of SER and jeopardise the robustness of predictions. Here, we focused on area-to-point spatial misalignment where environmental data are available at a grain (covariate grain) coarser than the ecological grain. We used simulations to study the effect of area-to-point misalignment on explanatory and predictive performances of three SDMs: a GLM, a spatial GLM and a Berkson Error Model (BEM) that accounts for covariate fine-grain heterogeneity within coarse grain cells. Overall, area-to-point misalignment reduces the explanatory power of the two GLMs by flattening estimated SER. Contrastingly, the BEM accurately recovered the true SER. However, its predictive power was low and similar to the two GLMs when predicting from coarse-grain data making it impossible to identify this model as the best model in a classical model selection framework. For all models, the increase of environmental heterogeneity reinforced the negative effect of area-to-point misalignment. Notwithstanding this, training models with data more heterogeneous than those used for predictions reduced the negative effect of spatial misalignment. While the BEM appears as a promising alternative to refine estimates of SER at the ecological grain, this model should not be used to predict at the covariate grain. It could however be used to downscale predictions from coarse grain datasets (e.g. IUCN range maps) covering the full species range, hence avoiding niche truncation problems.

**Keywords:** species distribution models, misalignment, spatial resolution, spatial grain, generalised linear models, Berkson error models

# Introduction

Since their emergence several decades ago [@guisan2000], species distribution models (SDMs) have been broadly used to guide management or conservation actions [@guisan2013]. By estimating species-environment relationships (SER), SDMs can characterise the suitable environmental conditions that management actions ought to maintain for effective conservation of any given species of interest [@greenwood2016]. SDMs have also been used to predict species distribution ranges under both current and future environmental conditions and have therefore helped managers prioritise areas for conservation actions [@zurell2021]. For such purposes, estimating SERs and associated species distributions at fine grain (i.e. high resolutions) is key to designing ecologically-relevant management areas [@mcpherson2006].
 
To date, SDMs have mostly been fitted with coarse-grain environmental covariates [@austin2011], with the underlying assumption that species distributions are mainly driven by global or regional climate [@pearson2003]. However, recent evidence has questioned this hypothesis [@rebaudo2016] with a number of studies showing that species distribution can also vary locally due to micro-climate variability [@meineri2017; @lembrechts2019]. For instance, @ashcroft2009 highlighted the importance of fine-grain climate variability on the distribution of mountainous species. Similar studies conducted in forest systems revealed that canopy protection from sun radiation can buffer the effect of regional climate conditions by acting as a micro-refugia for some species [@zellweger2020; @stark2022]. Hence, relying only on coarsely-resolved environmental covariates in SDMs can produce a mismatch between the ecological grain, the grain at which the environment influences a species, and the analysis grain of covariate (hereafter covariate grain), the grain at which the environment is described by covariates [@lu2023, @potter2013]. Such a mismatch might lead to misestimated SERs and low predictive power [@seo2009; @mcinerny2011], particularly if the ecological grain is finer than the resolution of environmental covariates [@connor2018].

Ideally, the relevant grain for environmental covariates/predictors in SDM should be defined by ecological knowledge regarding the study species [@dormann2007promising]. Unfortunately, grains of underlying ecological processes are generally unknown before the design of monitoring programs [@fletcher2023]. Moreover, SDM studies commonly rely on existing species and environmental data, which largely limits the choice of analysis grains [@manzoor2018]. For instance, many species data used in SDMs are collected at geo-referenced spatial locations (e.g., GBIF; @faurby2018), while associated environmental covariates are often derived from gridded climate re-analysis product [e.g., WorldClim @hijmans2005 or NOAA products (https://www.ncei.noaa.gov/) for terrestrial and marine environments] or remote sensing data [@pettorelli2014]. Thus, combining existing data from heterogeneous datasets is likely to induce area-to-point spatial misalignment [@gotway2002], that is a mismatch between a given covariate grain and a finer ecological response grain.  

Area-to-point misaligned datasets can be spatially matched by either upscaling or downscaling the resolution of the response variable or covariates respectively [@latimer2006; @keil2013]. Upscaling methods such as spatial thinning of fine-grain response data within coarse-grain environmental cells can be used [@steen2021], but lead to information loss. Thus, downscaling might be preferred when the analysis aims to predict fine-grain species distribution. However, even if methods for downscaling environmental data exist [@hewitson1996], they are rarely applied in SDM-based studies [@manzoor2018]. Thus, area-to-point misalignment is usually not considered when describing fine-grain species distribution, implying that fine-grain species records within a coarse-grain grid are all associated with the same environmental value despite known fine-grain environmental heterogeneity [@latimer2006]. This "na√Øve" downscaling can introduce errors in model covariates, which can compromise SDM accuracy [@latimer2006]. For instance, considering environmental data at a grain coarser than the ecological grain [@potter2013] implies that the observed environment is a smoothed (less variable) version of the environment experienced by the species (Fig. \@ref(fig:fig1); @mcinerny2011). @mcinerny2011 showed that such errors in covariate estimates could flatten estimated SERs with consequences on model predictive performance. In addition, not considering fine-grain environmental heterogeneity is likely to induce spatial autocorrelation not captured by the coarse-grain covariate, leading to bias in SDMs [@deknegt2010; @dormann2007methods]. Here, we investigate the performance of two methods previously proposed to account for the fine-grain variability not described by coarse-grain environmental covariates: Berkson error models [BEMs, @mcinerny2011; @minaya2018] and point-level spatial GLMs [@latimer2006].

```{r fig1, out.width = "100%", out.height = "100%", dpi = 300, fig.cap = "Illustration of area-to-point misalignment effect on simulated relationships between an explanatory variable (X) and species probabilities of presence ($\\psi$). Left panel A) represents a scenario with no misalignment, where species and environmental data are both sampled at the ecological grain (EG, grain at which the species is influence by the environment). Right panel B) represent a scenario where covariate is a gridded climate re-analysis product describing average environmental conditions at a given covariate grain (CG) coarser than the ecological grain at which species presence-absence (Y) are sampled. Superscripts indicate the grain at which the data are sampled. Black lines represent the (true) simulated species-environment relationship used to simulate the probabilities of presence from the covariate at ecological grain. Points represent hypothetical samples of 300 locations from which environmental data have been extracted at A) the ecological grain or B) a coarser covariate grain. Note the difference of amplitudes in observed covariates (x-axis) between A) and B)."}

knitr::include_graphics(here::here("results", "img", "figure1.pdf"))
```

BEMs and spatial GLMs account for unobserved fine-grain environmental variability in different ways. BEMs estimate SERs by fitting the response variable to an unobserved (error-free) covariate assumed to be more variable than the available (error-prone) covariate (see @blangiardo2015 and @muff2015 for more details). Alternatively, spatial GLMs include a random spatial effect that accounts for unexplained fine-grain variability [@latimer2006]. To our knowledge, the efficiency of these two models in accounting for area-to-point misalignment in SER estimates has not been thoroughly tested. Indeed, although @mcinerny2011 investigated the ability of BEM for estimating SERs, they assumed a known variance error between the unobserved error-free and the observed error-prone environment. This information is however unavailable for most climatic datasets. In addition, spatial GLMs can improve explanatory or predictive power compared to non-spatial models when spatial heterogeneity remains unexplained by covariates [@dormann2007methods]. However, to our knowledge, spatial GLMs have not been tested in the case of area-to-point misalignment. 

In this study, we investigate how area-to-point misalignment, when environmental data are available at a coarser grain than the ecological grain, affects the performance of three alternative SDMs: a GLM (a frequently used SDM; @norberg2019), a spatial GLM and a BEM, which can both be relevant to address area-to-point misalignment [@latimer2006; @minaya2018]. We expect the problem of spatial misalignment not only to vary across models but also to increase with both increasing environmental heterogeneity, and coarsening of covariate grain (i.e. higher level of spatial misalignment). Relative to the GLM, the BEM and the spatial GLM are expected to more accurately estimate SERs [@latimer2006, @mcinerny2011], but how well they can predict fine grain species distributions using coarse grain environmental data remains unclear. Using simulations, we assessed alternative models performances regarding (1) SERs estimates and (2) predictive power in new environments across different levels of spatial heterogeneity and spatial misalignment. 


# Materials and methods

## Terminology and data structure
Area-to-point misalignment describes the case where we observe a response variable (e.g., species occurrences, count, presence-absence) at $N$ spatial point locations, while associated explanatory variables (e.g. environmental descriptors) are available at a coarser grain, typically across a grid of $I$ cells, each of which can contain multiple sampling points. Importantly, environmental variability is usually neglected within each cell where all points are assumed to share the same environment. This leads to an area-to-point misalignment problem where the grain of the response variable is finer than the one of the predictor variable. We denote $Y_{j(i)}^{RG}$ the observed response variable (where RG stands for response grain) at sampling point $j$ within grid-cell $i$, for $i = \{1, \cdots, I\}$ and $j(i) = \{1, \cdots, J_i\}$ , with $J_i$ the number of sampling points in grid-cell $i$ and $\sum_i^I J_i = N$ the total number of sampling points. $X_{j(i)}^{CG}$ is the value of the available covariate (where CG stands for the covariate grain, which is coarser than the RG) within grid-cell $i$ for any sampling point $j(i)$. $X_{j(i)}^{RG}$ is the true (or error-free) value of the environmental variable at sampling point $j$ within grid cell $i$ (i.e. at the same resolution as the response variable). In the case of the area-to-point misalignment described in this study, $X_{j(i)}^{RG}$ is unobserved and assumed to drive ecological processes (species distribution in this case). As such, the response grain is considered as equal to the ecological grain (denoted EG; i.e. the grain at which the ecological process takes place). Note that this case of area-to-point misalignment can be extended to cases where the response variable is observed at a grid-level (i.e. not necessarily points) at a finer resolution than the CG. 

## Simulation study

We tested the effect of area-to-point spatial misalignment on the explanatory and predictive performances of the models using a virtual species approach [@meynard2013] where species distribution depends on a single covariate. The simulation design, represented in Fig. \ref{fig:fig2}, consisted of three steps: (A) a data generating step using a known underlying SER to simulate 90 datasets subject to three different levels of area-to-point misalignment, (B) a model fitting step where the three models were fitted to the different simulated datasets for a total of 270 models, and (C) a model evaluation step to assess the ability of models to explain, interpolate and extrapolate probabilities of species presence at the ecological grain.

We simulated a grid of 1000 x 1000 points representing a virtual sampling area. The grain of this grid, the point level, was next considered as the ecological grain (EG). We simulated the virtual environment as a Gaussian spatial random field using a Mat√©rn covariance matrix to represent spatial dependencies between spatial units. We set the spatial range ($\rho$, i.e. the distance at which the spatial correlation is close to 0.1; @lindgren2011) and variance ($\sigma^2$) parameters of the Mat√©rn function to 50 units and 1, respectively. From these point-level environmental values (i.e. covariate values at the ecological grain $X^{EG}_j$) we calculated virtual probabilities of presence at the point level (i.e. at the ecological grain, $\psi^{EG}_j$) using a quadratic linear relationship: $\psi^{EG}_j = \beta_0 + \beta_1 X^{EG}_j + \beta_2 {X^{EG}_j}^2$. We chose the coefficients ($\beta_0$ = 3, $\beta_1$ = 1.5, $\beta_2$ = -3) to describe a sharp bell-shaped SER. We then simulated the species presence-absence data at the point level, $Y^{EG}_j$, using random draws from a Bernoulli distribution with parameter $\psi^{EG}_j$.

In the virtual observation process, we coarsened the resolution of the point-level environment by a factor 5, 25 or 50 corresponding respectively to three different covariate grains (fine, medium, or coarse). The environment at grid level was generated by averaging point level environmental values comprised within each grid cell ($X^{CG}_i = \frac{1}{J_i}\sum_{j(i)}X^{EG}_{j(i)}$). We chose the three grain sizes as fractions of $\rho$ the environmental spatial range ($\rho/10 = 5$, $\rho/2 = 25$, $\rho = 50$). By doing so, we assumed that the effect of area-to-point misalignment depends on a ratio between the covariate grain and the environmental spatial heterogeneity rather than the absolute value of the covariate grain [@gotway2002; @naimi2014]. Indeed, we expect a greater loss of information when coarsening the covariate in heterogeneous environments (low spatial range) than in homogeneous ones (high spatial range; @lu2023; @guo2023).

We then virtually sampled the simulated survey area by randomly selecting 300 sampling points. We simulate no bias in species sampling (i.e., perfect detection). Observed presence-absence data were thus equal to those simulated at the ecological grain (i.e. $Y_{j}^{RG} = Y_j^{EG}$). At each sampling point $j$, observed covariate corresponds to the grid-level environment (i.e. for any point $j$ within grid cell $i$: $X_{j(i)}^{CG} = X_i^{CG}$). We replicated the virtual sampling process 30 times, resulting in 90 simulated datasets (3 response grains x 30 replications). The three models were fitted on each dataset (i.e. 90 train datasets and 270 fitted models).

To evaluate the predictive performance of the models, we also simulated three different types of test datasets. First, to evaluate interpolation, for each train dataset we randomly sampled 300 new points within the same environment as for train datasets. To evaluate extrapolation, we simulated two new grids of 1000 x 1000 points $X_{new1}$ and $X_{new2}$ where the environmental conditions were more homogeneous or more heterogeneous relative to the train datasets, with associated spatial correlation range of environmental values five times larger for $X_{new1}$ ($X_{new1} = 250$) and five times smaller for $X_{new2}$ ($X_{new2} = 10$). For both new environments, the same generating process as for the train dataset was applied producing known probabilities of presence, presence-absence data and covariate values at the three covariate grains.
```{r fig2, eval=FALSE, echo=FALSE, dpi = 300, fig.cap = "Representation of the simulation study, from data generation and model fitting to model evaluation, which was designed to quantify the effect of area-to-point spatial misalignment on three models' explanatory and predictive performances. EG = Ecological Grain (grain at which species experiences its environment); CG = Covariate Grain (grain of the covariate used to fit the models, with indices f, m and c standing for fine, medium and coarse, the different grain sizes); BEM = Berkson Error Model; spGLM = point-spatial GLM; $\\psi$ = probability of presence; RMSE = Root-Mean-Square Error."}

knitr::include_graphics(here::here("results", "img", "figure2.pdf"))
```
\begin{figure}
\includegraphics[height=0.85\textheight]{figure2.pdf} \captionof{figure}{Representation of the simulation study, from data generation and model fitting to model evaluation, which was designed to quantify the effect of area-to-point spatial misalignment on three models' explanatory and predictive performances. EG = Ecological Grain (grain at which species experiences its environment); CG = Covariate Grain (grain of the covariate used to fit the models, with indices f, m and c standing for fine, medium and coarse, the different grain sizes); BEM = Berkson Error Model; spGLM = point-spatial GLM; $\psi$ = probability of presence; RMSE = Root-Mean-Square Error.} 
\label{fig:fig2}
\end{figure}
  
## Modelling framework
Three models were considered: a Generalized Linear Model (GLM), a spatial Generalized Linear Model (sp-GLM), and a Berkson Error Model (BEM). We fitted these models on presence-absence data, but note that these models can be fitted to other response variables (e.g. detection/non-detection, count, presence only). All models assume that the response variable $Y^{RG}_{j(i)}$ at sampling point $j(i)$ (i.e. at the expected ecological grain) included in cell $i$ relies on the probability of presence $\psi^{RG}_{j(i)}$: $Y^{RG}_{j(i)} \sim Bernoulli(\psi^{RG}_{j(i)})$. Each model makes specific assumptions about the relationship between the probability of presence and the environment. We fitted all models using scaled covariates (with mean 0 and standard deviation 1). For simplicity, we present the formulation of the alternative models using one misaligned covariate, but this can be extended to more covariates.

Three models were considered: a Generalized Linear Model (GLM), a spatial Generalized Linear Model (sp-GLM), and a Berkson Error Model (BEM). We fitted these models on presence-absence data, but note that these models can be applied to other response data types (e.g. detection/non-detection, count, presence only). All models assume that the response variable $Y^{RG}_{j(i)}$ at sampling point $j(i)$ (i.e. at the expected ecological grain) included in grid-cell $i$ relies on the probability of presence $\psi^{RG}_{j(i)}$: $Y^{RG}_{j(i)} \sim Bernoulli(\psi^{RG}_{j(i)})$. We assumed that the probability of presence is related to the environment through different formulations depending on the model. We fitted all models using scaled covariates (with mean 0 and standard deviation 1). In the following, we present the model formulations using a unique misaligned covariate for simplicity, but this can be extended to more covariates.

The GLM considers that the environment at the covariate grain (i.e. the grid level), $X^{CG}_i$, is the only driver of variation in the probability of presence at the point level. In other words, the GLM assumes that the covariate grain is equal to the ecological grain. Thus the SER is modelled as follows:
$$ logit(\psi^{EG}_{j(i)}) = \beta_0 + \beta_1 X^{CG}_i + \beta_2 {X^{CG}_i}^2 $$
where $\beta_0$ is the probability of presence on the logit-scale in average environmental conditions (i.e., when the scaled covariate is null), $\beta_1$ and $\beta_2$ are the coefficients representing respectively the linear and the quadratic effects of environmental covariate $X^{CG}$. Note that we used a logit-link function as we modelled presence-absence data, but other link functions can be used depending on the type of data considered (e.g. a log-link function can be used for count data modelled with a Poisson distribution).   

The spatial GLM is a mixed model that incorporates a spatial random effect, $\gamma_{j(i)}$, that allows variability between spatial points within a given covariate-grain grid cell. This spatial random effect allows capturing spatial signals not explained by the predictors [@zurell2021]. For example, unobserved spatial patterns could result from missing spatially coherent or biological predictors (e.g., dispersal ability). Here, the spatial random effect is supposed to capture variability at the ecological grain, within each covariate grain cell. It is assumed that the probability of presence not only depends on the covariate grain environment (as for the classic GLM) but also varies depending on a fine grain latent spatial field. The model is written as follows:
\begin{align*}
logit(\psi^{EG}_{j(i)}) &= \beta_0 + \beta_1 X^{AG}_i + \beta_2 {X^{AG}_i}^2 + \gamma_{j(i)} \\
\boldsymbol{\gamma} &\sim MVN(\boldsymbol{0}, \boldsymbol{\Sigma})
\end{align*}
where $\boldsymbol{\gamma}$ is a vector of dimension $N$, $\boldsymbol{\Sigma}$ is the spatial covariance structure whose generic element is $\Sigma_{u,v} = \sigma_\gamma^2 \times Matern(d_{u,v}, \kappa)$ where $\sigma_\gamma^2$ is the variance component, $Matern(\cdot,\cdot)$ is the Mat√©rn function which describes how the correlation between two points (here $u$ and $v$) decreases with the Euclidean distance separating them (denoted $d_{u,v}$), and where $\kappa$ is a scaling parameter related to the spatial range $\rho$, i.e., the distance at which the spatial correlation between two points is close to 0.1. It can be derived from $\kappa$ by: $\rho = \frac{\sqrt{8\nu}}{\kappa}$, with $\nu$ representing the degree of smoothness of the spatial process and usually fixed to one (@zuur2017, p197).

The BEM jointly estimates the covariate and probability of presence at the point level (i.e. the ecological grain). It considers that the observed environment at the grid level $X^{CG}_i$ is a smoothed version of the environment at the finer ecological grain $X^{EG}_{j(i)}$, which is assumed to be the "true" driver of species distribution. This latent variable is modelled as follows:
$$X^{EG}_{j(i)} \sim N(X^{CG}_i, \sigma_X^2)$$
with $\sigma_X^2$ the variance parameter that describes the fine grain variability lost by averaging the environment at coarser grains. The probability of presence is modelled as a function of the latent variable $X^{EG}$:

$$ logit(\psi^{EG}_{j(i)}) = \beta_0 + \beta_1 X^{EG}_{j(i)} + \beta_1 {X^{EG}_{j(i)}}^2.$$

## Parameter estimation
We fitted the GLM and the BEM within a Bayesian framework using MCMC sampling with the R package nimble [@devalpine2017, @rcoreteam]. We ran three chains for each analysis with a burn-in of 10,000 and an additional 200,000 iterations with a thinning rate of 50. For prior distributions of parameters $\beta_1$ and $\beta_2$, we used normal distribution with a zero mean and a precision of 0.1. For the intercept, $\beta_0$, we specified a prior distribution on a derived ecologically meaningful parameter, $\psi^{\star} = logit^{-1}(\beta_0)$, representing the species probability of presence in average environmental conditions. We used a uniform prior bounded between 0 and 1 for this derived parameter, assuming no prior knowledge on species distribution patterns in average environmental conditions. We used half-Cauchy prior [@gelman2013] for the standard-deviation parameter in the BEM ($\sigma_X$). We assessed convergence by examining the Gelman-Rubin statistic ($\hat{R}$) with a threshold fixed to 1.1 [@gelman2013]. 
We fitted the sp-GLM using the INLA and SPDE approaches using the R package R-INLA [@rue2009; @lindgren2011]. The "big n problem", i.e. large number of sampling locations, in spatial analysis prevented us from using MCMC samplers [@kery2021]. We used R-INLA's default priors for the regression coefficients. We assigned a fixed shape ($\nu = 1$), and penalized complexity priors for the spatial range  $\rho$ and marginal standard deviation $\sigma_{\gamma}$, such that $Pr(\rho < 1) = 0.05$, and $Pr(\sigma_{\gamma} > 5) = 0.05$. The mesh was constructed to allow fine grain variability by specifying a max edge length of 10, smaller than the spatial environmental range.

## Model performance assessment
We evaluated model performance by investigating their ability to (1) infer the simulated SER (i.e. the explanatory power at the ecological grain), (2) predict species distribution in new locations of the study area (i.e. their predictive power with regards to interpolation), and (3) predict species distribution in new environments (i.e. their predictive power with regards to extrapolation, also called model transferability; @yates2018). Regarding (2) and (3), predictions were made from covariate grain data because in practice, although the aim is to estimate the SER and predict species distribution at the ecological grain, this grain is usually not available (otherwise, one would just use these data for model fitting). Yet, we also evaluated the model's predictive power from ecological grain covariate. Since results were similar to the ones related to (1), we here only present results associated with estimates of SER.

Regarding explanatory power, we calculated the relative bias regarding three parameters (Fig. 2, B1) describing the SER (Supporting information): the maximum probability of presence ($\psi_{max}$), the environmental optimum ($\theta$; i.e. the environmental value associated with $\psi_{max}$), and the width of the SER at a specified probability threshold of 0.05 ($\omega$; i.e. a measure of the species ecological tolerance). We also evaluated explanatory power by computing discrimination and calibration metrics that do not require knowledge of the true SER, as is the case in real case studies. To assess model discrimination (i.e. model ability to distinguish between occupied and unoccupied sites) we calculated the area under the receiver operator characteristic curve (AUC). To assess model calibration (i.e. model accuracy with regards to predicted probabilities of presence) we calculated Brier‚Äôs Score (Brier). Brier assesses the mean squared error between predicted probabilities of presence and observed presence-absence, thus lower values are better [@liu2011]. Both metrics were calculated by comparing observed presence-absence used to fit the models to probabilities of presence predicted from observed environmental values by the fitted models. 

To evaluate the predictive power of the three models, we compared simulated probabilities of presence (i.e. true values, $\psi_{j'}$) with those predicted from the covariate grain environmental values by the fitted models (denoted $\tilde\psi_{j'}$). These comparisons were conducted for the three types of test datasets: the one used to evaluate the interpolation ability of the models and the two used for assessing extrapolation capacity of models in more homogeneous or heterogeneous environments. We measured average accuracy of models to predict species probabilities of presence by calculating the root-mean-square errors (RMSE) as follows:
$$RMSE = \sqrt{\frac{1}{J'}\sum(\psi_{j'} - \tilde\psi_{j'})^2}$$
where $\psi_{j'}$ is the true probability of presence at site $j‚Äô$, $\tilde\psi_{j'}$ is the mean predicted value by fitting models (i.e. the mean of posterior distribution) and $J‚Äô$ is the number of sites. Low values indicate a higher accuracy. We also computed prediction interval scores (PIS; see equation (43) in @gneiting2007) that evaluate precision and coverage of credible intervals of predictions by penalizing large intervals and intervals that do not include the true value, with high values indicating poor predictive performance. As for explanatory power, we also computed discrimination (AUC) and calibration (Brier) metrics where predicted probabilities of presence were compared with observed presence-absence of the test data.

# Results

## Estimation of species-environment relationships

For all three models, biases in estimates of SER increased with increasing covariate grain sizes (i.e. decreasing covariate resolution), but responses varied across models (Fig. 3). The three models produced, on average, accurate estimates of optimum positions for all covariate grains but variability among replicates of relative bias in optimum estimates increased with increasing grain size from 0.16 to 0.50 and from 0.16 to 0.49 for GLM and spGLM respectively, and from 0.16 to 0.64 for BEM. For the three models, both underestimating of maximum probability of occurrence, and overestimating of ecological width, increased with covariate grain size leading to flatter SER estimates (Supporting information). BEM produced the smallest bias, with a mean negative relative bias in maximum probability estimates of -0.03 (sd = 0.02) and a mean positive relative bias in ecological width estimates of 0.05 (sd = 0.11) at the coarsest resolution. In comparison, GLM and spGLM produced relative bias 7.3 and 6.7 times larger for maximum probability and relative bias in ecological width estimates 7.6 and 7 times larger than the BEM at the coarsest grain size. 

\begin{figure}
\includegraphics{figure3.pdf} \captionof{figure}{Ability of the three alternative models (BEM, Berkson Error Model; GLM, Generalized Linear Model; spGLM, spatial GLM; colour-coded on the graph) to infer the simulated species-environment relationship when fitted to environmental covariate at three grain sizes coarser than the ecological response grain. Relative bias between simulated and estimated values were calculated for three parameters describing unimodal species-environment relationships (a) maximum probability of presence, b) environmental optimum, and c) ecological width. Shaded points represent bias for each of the 30 simulated train datasets. Filled points represent the average bias among all train datasets while the vertical bars represent the associated standard-deviations.} 
\label{fig:fig3}
\end{figure}

Performance metrics comparing observed presence-absence with predicted probabilities of presence from environmental covariate grain data indicated a decrease in explanatory power of the three models with increasing covariate grain size (Fig. 4). However, in contrast with previous results, these performance metrics suggested a lower explanatory power of the BEM than the spGLM at all covariate grain sizes with regards to both model calibration (higher Brier scores for the BEM) and discrimination (lower AUC values for the BEM). The GLM had equivalent discrimination power as the BEM and better calibration power, with lower Brier scores when fitted with covariates at medium and coarse grain sizes.

\begin{figure}
\includegraphics{figure4.pdf} \captionof{figure}{Explanatory performances of the three alternative models (BEM: Berkson-Error Model, GLM: Generalized Linear Model, spGLM: spatial GLM) fitted with simulated point-level presence-absence data (i.e. at ecological grain) and grid-level covariate resolved at different grain sizes coarser than the ecological response grain. Model performance was evaluated with regards to a) discrimination and b) calibration power by comparing the point-level presence-absence with the predicted point-level probabilities of presence from grid-level environmental values. Filled points represent mean performance metrics over the 30 simulated train datasets (shaded points) while vertical bars represent the associated standard deviations.} 
\label{fig:fig4}
\end{figure}

## Predictive performance
Predictive performance of all models, in terms of both interpolation and extrapolation, decreased with increasing covariate grain size and spatial heterogeneity (Figure 5). The lowest predictive performances were obtained when fitting models at the coarsest covariate grain while predicting in more heterogeneous environmental conditions than the training set. The three models had similar discrimination ability (Figure 5 first row) for all covariate grains and types of test data, though variations were observed depending on calibration metrics. Since Brier and RMSE produced similar results we only present results from the former (Supporting information for RMSE results). Different results were obtained with the PIS. Brier indicated equivalent predictive abilities for GLM and spGLM for both interpolation and extrapolation, regardless of environmental heterogeneity. In comparison, when fitted with medium and coarse covariate grains, BEM had lower predictive abilities when interpolating or when extrapolating in more heterogeneous conditions, whereas it performed slightly better in homogeneous environments. GLM had the worst PIS in all scenarios and was the most negatively affected by misalignment, because it tended to produce too confident predictive intervals not including the true value (Supporting information). The BEM and spGLM produced equivalent PIS in the case of interpolation. However, spGLM was better at predicting ecological grain species distribution from environmental covariate grain data in a more heterogeneous environment for all covariate grain sizes, while BEM was better at predicting in a more homogeneous environment for all covariate grain sizes. 

\begin{figure}
\includegraphics{figure5.pdf} \captionof{figure}{Evaluation of predictive performance of three models (BEM: Berkson-Error Model, GLM: Generalized Linear Model, spGLM: spatial GLM) fitted with a misaligned covariate at three covariate grains coarser than the ecological grain with regards to their ability to predict species distribution at the ecological grain from environmental values at the covariate grain across three levels of environmental spatial heterogeneity (the three columns). 2nd column informs on models‚Äô interpolation ability with predictions performed at a random set of locations selected within the same environment as the training set. 1st and 3rd columns inform on models‚Äô extrapolation ability with predictions performed at a random set of locations selected within a more homogeneous environment (1st column) or a more heterogeneous environment (3rd column) than the one used to simulate train datasets. Performance metrics were computed by comparing predicted probabilities of presence at the ecological grain when fitting models at different covariate grains (fine, medium, coarse) against observed presence-absence (1st and 2nd row) or simulated probabilities of presence (3rd row) at the ecological grain. Filled points represent mean performance metrics over the 30 simulated train datasets (shaded points) while vertical bars represent the associated standard deviations.} 
\label{fig:fig5}
\end{figure}

Overall, for the majority of simulated scenarios, we found lower predictive performance with regards to calibration metrics for the BEM than for the two GLMs when predicting probabilities of presence at ecological grain from environmental values at covariate grain (Fig. 5). This result may seem in contrast with the results above indicating that the BEM accurately estimated SER (Fig. 3). This can be explained because of the differences between the observed SER at the covariate grain, which relies on a truncated description of the environmental conditions experienced by the species, and the true SER at the ecological grain (Fig. 1). In contrast, although the two GLMs less effectively infer the true SER, their predictive performance outcompete the BEM because, by essence, these models do not aim to estimate the true SER (at the ecological grain) but rather the observed SER at the covariate grain which directly advantages them when predicting from data at the covariate grain. However, because BEM better estimated SER at the ecological grain than the GLMs, it better predicted probabilities of presence at ecological grain from ecological grain environmental data (Supporting information).

# Discussion

In this study, we evaluated the effect of area-to-point spatial misalignment between predictor and response variables (i.e. mismatch between a covariate grain and a finer response grain) on the explanatory (estimates of SER) and predictive power of three alternative SDMs: a Berkson-Error Model (BEM), a GLM and a spatial GLM (spGLM). We performed simulations across different levels of (1) covariate grain sizes and (2) environmental heterogeneity to compare the three models‚Äô response to area-to-point spatial misalignment. The BEM performed well in estimating SER with an average bias ~7 times smaller than for the GLM and the spGLM, which both estimated flatter SERs. Despite its better performance in estimating SER, the BEM did not perform well in predicting species distributions from coarse grain data, with a performance similar to the two other models. In fact, for all models, predictive power decreased with increasing area-to-point spatial misalignment. This bias was particularly pronounced as the degree of environmental heterogeneity increased. Altogether, these findings suggested that despite a lower performance in estimating SER, the GLM and its spatial counterpart performed better than the BEM in predicting species distributions from covariate-grain data, and would therefore be selected in a model selection framework. However, because SER are misestimated by these two models, this selection process could be problematic (1) for ecological interpretation (e.g. poor estimate of environmental tolerances) and (2) when predicting in novel conditions, particularly in more spatially heterogeneous environments.

As expected, area-to-point misalignment implies a loss of information, leading to an erroneously smoothed environment (Fig. 1, Supporting information). This error in covariates is known as the regression dilution problem and leads to flattened unimodal SER estimated by GLMs [@mcinerny2011]. In this study, we show that the BEM accurately estimates ecological grain SER features even when fitted with coarse grain covariate. The BEM thus appears as an interesting candidate model to account for area-to-point misalignment when estimating SERs. This finding is in line with previous studies assuming a known degree of error in the smoothed environmental conditions at covariate grain relative to the finer and more variable ecological grain values [@mcinerny2011]. Here, we highlight that specifying the degree of error is not a prerequisite for BEM to accurately estimate SER at the ecological grain, which widens its potential application in a range of contexts. Nevertheless, note that the BEM we developed assumes a constant error across grid cells (i.e. spatial stationarity @dormann2007methods). This assumption may not always be reasonable, especially in broad-extent studies, and additional research is needed to investigate how model performance is affected when violating this assumption. By contrast with BEM, we highlight from simulations that adding point-level spatial random effects does not solve the regression dilution problem. Simultaneously, we find that explanatory performance metrics calculated from the observed presence-absence suggest the opposite, that is, a better fit with the spatial GLM than with the BEM despite a flattened SER relative to the true one. Hence, a model selection framework based on performance metrics can erroneously select the spatial GLM to identify the drivers of species distribution. Then, following standard SDM workflows one can select important variables based on their significance [@latimer2006]. Yet, because spatial GLMs produce flattened SER and larger estimates of uncertainty about SER, this approach may discard even more important drivers of species distribution due to area-to-point misalignment than non-spatial GLM [@mertes2018]. Thus, if the study aims to identify the ecological processes driving species distributions, spatial GLM fitted with only coarse covariates should not be used unless there is evidence (e.g. from the literature) that the covariate grain matches the ecological grain.

For the three models, predictive power (both calibration and discrimination) decreased as the magnitude of area-to-point spatial misalignment increased. This problem is strengthened by the level of environmental heterogeneity because for a given magnitude of spatial misalignment, the loss of information strongly increases with both coarsening of covariate grain and increasing spatial heterogeneity (Supporting information). Such synergistic effects have already been observed when fitting non-spatial GLMs for both point-to-point [@naimi2014] and area-to-point spatial misalignments [@connor2018]. Here, we add to previous knowledge by showing that BEM and spGLM - two models potentially relevant to account for area-to-point misalignment] - are also sensitive to the combined effects of covariate grain size and spatial environmental heterogeneity. Specifically, both BEM and spatial GLM have equivalent discriminatory abilities as GLM when predicting fine grain species distribution from covariate grain, implying that they can not account for misalignment in this regard. However, they can improve predictions of probabilities of presence (i.e. model calibration) relatively to GLM. BEM proves to be better when predicting in smoother environment, but poorer for equally or more heterogeneous environments than the one used for model fitting. Measurement error models, and thus BEMs, are not assumed to perform better than GLMs with regards to predictions when using error-prone predictors [@stoklosa2015], in our case new environmental conditions at covariate grain. This is because GLMs estimate covariate grain SER, while BEMs estimate ecological grain SER; then, it follows that the best predictions will arise from the GLMs when using covariate grain predictors. However, because magnitude of spatial misalignment effect is not only induced by the mismatch between covariate and ecological grain but also by the level of covariate spatial heterogeneity [@mertes2018], the covariate grain SER fitted by the GLMs does not necessarily reflect the covariate grain SER in new environmental conditions. For instance, in more homogeneous environments, because effect of misalignment is attenuated by low spatial heterogeneity, the covariate grain SER is closer to the ecological grain SER, explaining the relative better performance of BEM in those situations. The spatial GLM produces equivalent mean predictions of presence probabilities as GLM in all scenarios, but better estimates of uncertainties associated with those predictions. This result confirms that spatial GLM improves uncertainty estimates when spatial autocorrelation is not entirely explained by covariates [@dormann2007methods], which is to expect in case of area-to-point misalignment [@deknegt2010]. 

Overall, we emphasize that spatial GLM and BEM can help to account for issues arising from area-to-point misaligned data in SDMs, although not regarding all aspects of model inference. For instance, spatial GLM can improve quality of predictions by a better estimation of uncertainties associates with predictions compared to classic GLM. However, spatial GLM as classic GLM produces biased SER and thus should not be used for ecological interpretation about species distribution drivers, unless external evidences show that the covariate grain matches the ecological grain. Besides, its capacity to better predict species distribution in new environmental conditions is also limited by its biased SER. For instance, in a different context (e.g. fine-grain environmental data obtained from remote sensing in the same area or extrapolation in another area presenting a higher spatial heterogeneity) spatial GLM would perform poorly because the estimated covariate SER would no longer correspond to the SER at the new covariate grain. Hence, the BEM because of its accuracy to retrieve the true SER (i.e. at the ecological grain) appears as a more interesting candidate to fit area-to-point misaligned data. We also believe that further investigations on BEM behaviours can widen its range of applications and benefit to SDM-based studies. For instance, it would be interesting to investigate BEM behaviours in more complex scenarios than the one tested in our simulations. Specifically, rather than considering only one source of variability uncaptured by covariates (i.e. the loss of fine-grain environmental variability due to spatial misalignment), considering additional sources of variability (e.g. missing predictors, temporal misalignment) often present in real case studies. One can also be interested in testing the accuracy of BEM when species distribution is influences by multiple covariates with different ecological grains? Finally, we believe that BEM can be of great interest in case of niche truncation, i.e. when species data only cover a part of species geographic ranges resulting in biased SDMs [@chevalier2021]. This problem occurs because highly resolved distribution data are usually available over small spatial extent, typically a region or a country. In such cases, data integration methods can be used to overcome the spatial truncation of the fine-grain dataset by integrating global distribution data at coarse grains. Our findings suggest that the BEM can be a useful alternative to account for fine-grain spatial heterogeneity when fitted only with coarse-grain global dataset [@chevalier2021] or can be used in integrated SDM  to refine the SER obtained from the coarse-grain global dataset [@pacifici2019]. By making it possible to refine estimates of the SER at a grain that matches the ecological grain (i.e. the grain at which ecological processes act on species), the BEM (and potentially integrated SDMs using a BEM to model the coarse grain data) should be of great interest for managers and stakeholders that need accurate predictions at a high resolution.

# References
<div id="refs"></div>
